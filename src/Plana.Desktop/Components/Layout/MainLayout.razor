@inherits LayoutComponentBase
@inject IJSRuntime JsRuntime

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<script>
    window.onApplicationInitialize = ({ configuration, ...rest }) => {
        if (configuration === "DEBUG") {
            const head = document.head;
            const { content } = rest;

            const script = document.createElement("script");
            script.src = "https://cdn.tailwindcss.com";
            script.onload = () => {
                // workaround for TailwindCSS CDN execution
                head.appendChild(document.createElement("script"));
            };

            head.appendChild(script);

            const config = document.createElement("script");
            config.innerHTML = `const tailwind = window.tailwind || {};${content}`;
            head.appendChild(config);
        }
    }
</script>

@code
{
    protected override async Task OnInitializedAsync()
    {
#if DEBUG
        var path = new StreamReader(await FileSystem.Current.OpenAppPackageFileAsync("tailwind.config.js"));
        var content = await path.ReadToEndAsync();
        await JsRuntime.InvokeVoidAsync("onApplicationInitialize", new { configuration = "DEBUG", content = content.Replace("module.exports", "tailwind.config") });
#endif
    }
}
